# redis
## redis 数据类型
* 字符串key,如果字符串是数字类型，可以进行运算
    * del 删除键
    * get 得到键值
    * set 设置键值
    * mget mset 批量操作
* 散列 key field value:
    * hset key field value 设置
    * hmset key field value [field value] 批量设置
    * hget key field 获取值
    * hmget key field [field ...] 批量获取
    * hdel 删除字段
* 列表
    * lpush rpush :在列表的左边或右边添加元素
    * lpop rpop: 列表左边或右边移除元素
* 集合:
    * sadd key member :添加集合元素
    * 集合间可以进行 交集 差集 并集运算
## 事物
* 事物的原理的将多条命令发送个redis，redis依次执行。节省了客户端和服务器频繁通信的网络开销
* 事物保证了所有命令要么执行，要么都不执行
* 错误处理:
    * 语法错误:指令都不执行
    * 运行错误:这种错误是无法再运行前发现，没有错误的命令或正常执行，需要手动rollback

```
MULTI
commond1
commond2
EXEC
```
## WATCH
* 被WATCH 监控的key。在事物中是无法被操作的。
## EXPIRE 到期时间
* 可以对key设置到期时间，常用语session 验证码等

## maxmemory:
    * 通过设定maxmemory可以用来现在redis的内存大小
    * redis 会更具实现设置好的策略来规划内存使用,一般使用LRU策略(最近最少使用)
## redis 实际应用
* 队列数据结构实现任务队列
* 发布/订阅模式(publish/subscribe)
* 分布式锁
    * set 设置锁,加NX参数。其他进程想要使用,使用set 反回0,无法获取，这时候,使用其他进程使用完锁
    * 设置过期时间,避免死锁 (设置过期时间和set不能分开进行，因为操作不是原子的)

## 管道(pipline)
* 一次性发送多条命令，一次性返回结果

## 持久化
* RDB方式: 根据规则将内存中的数据定时持久化到硬盘
    * 通过配置文件自动进行
    * 或者执行flushall命令
    * 主从模式 复制时
    * 用户执行save(服务器会阻塞客户端请求) bgsave(异步执行,不会阻塞)命令时
* RDB原理: Redis 使用fork 函数创建一个当前进程的子进程,父进程继续接受客户端命令，子进程开始往临时文件中备份数据,数据备份完成后替换旧的RDB文件，执行fork操作时,会使用写时复制技术(copy-on-write技术),fork函数发生的一刻与父进程共享同一内存数据。当父进程需要更改其中某片数据(如执行一个写命令),操作系统会将该片数据复制一份不受影响。所以RDB的数据是fork那一时刻的数据


* AOF: 记录每次执行的命令,通常和RDB结合使用,避免数据丢失
## 主从复制
* 可以配置主数据库写,从数据库读,主数据库会自动往从数据库备份数据
* 很适合读多写少的场景
* 主数据库奔溃:
    * 1.手工通过敏力将从数据库升级为主数据库,保证业务运行
    * 2.重新启动主数据库，设置为主数据库,这样就可以完成数据的恢复
## 哨兵
* 监控redis集群的运行状态
* 主数据库故障,可以自动升级从数据库为主数据库
* 哨兵直接相互监控

## 日常维护
* 密码访问
* 耗时命令监控

